[Unit]
Description           = BinaryBuilder AZP Agent ${AGENT_IDX}
StartLimitIntervalSec = 0
StartLimitBurst       = 0

[Service]
Environment           = AGENT_IDX=${AGENT_IDX}
EnvironmentFile       = ${SRC_DIR}/.env
WorkingDirectory      = ${STORAGE_DIR}/rootfs/agent_${AGENT_IDX}
ExecStartPre          = /bin/bash -c "mkdir -p ${STORAGE_DIR}/rootfs/depot/downloads"
ExecStart             = /bin/bash -c "PATH=/data/staticfloat/bb_azp/rootfs/usr/local/bin:${PATH} ./run_agent.sh"

# Always restart, don't limit restarts at all, restart once per second
Restart               = always
RestartSec            = 1

[Install]
WantedBy              = default.target
