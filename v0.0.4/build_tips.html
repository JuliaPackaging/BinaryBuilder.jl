<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Building Packages · BinaryBuilder.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link href="assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>BinaryBuilder.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="search.html"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="index.html">Home</a></li><li class="current"><a class="toctext" href="build_tips.html">Building Packages</a><ul class="internal"><li><a class="toctext" href="#Initiating-different-shell-commands-based-on-target-1">Initiating different shell commands based on target</a></li><li><a class="toctext" href="#Autoconfigure-builds-1">Autoconfigure builds</a></li><li><a class="toctext" href="#CMake-builds-1">CMake builds</a></li><li><a class="toctext" href="#Builds-with-binary-dependencies-1">Builds with binary dependencies</a></li><li><a class="toctext" href="#Editing-files-in-the-wizard-1">Editing files in the wizard</a></li><li><a class="toctext" href="#Other-examples-1">Other examples</a></li></ul></li><li><a class="toctext" href="FAQ.html">FAQ</a></li><li><span class="toctext">Internals</span><ul><li><a class="toctext" href="rootfs.html">RootFS</a></li><li><a class="toctext" href="environment_variables.html">Environment Variables</a></li><li><a class="toctext" href="tricksy_gotchas.html">Tricksy Gotchas</a></li><li><a class="toctext" href="reference.html">Reference</a></li></ul></li></ul></nav><article id="docs"><header><nav><ul><li><a href="build_tips.html">Building Packages</a></li></ul><a class="edit-page" href="https://github.com/JuliaPackaging/BinaryBuilder.jl/blob/master/docs/src/build_tips.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>Building Packages</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="Tips-for-Building-Packages-1" href="#Tips-for-Building-Packages-1">Tips for Building Packages</a></h1><p>BinaryBuilder provides a convenient environment to enable cross-platform building. But, many libraries have complicated build scripts that may need to be adapted to support all of the BinaryBuilder targets.</p><p><em>If you have additional tips, please submit a PR with suggestions.</em></p><h2><a class="nav-anchor" id="Initiating-different-shell-commands-based-on-target-1" href="#Initiating-different-shell-commands-based-on-target-1">Initiating different shell commands based on target</a></h2><p>Sometimes, you need to adapt build scripts based on the target platform. This can be done within the shell script. Here is an example from <a href="https://github.com/staticfloat/OpenBLASBuilder/blob/master/build_tarballs.jl">staticfloat/OpenBLASBuilder</a>:</p><pre><code class="language-sh"># Set BINARY=32 on i686 platforms and armv7l
if [[ ${nbits} == 32 ]]; then
    flags=&quot;${flags} BINARY=32&quot;
fi</code></pre><p>Here are other examples of scripts with target-specific checks:</p><ul><li><p><a href="https://github.com/davidanthoff/ReadStatBuilder/blob/cc1745add155224ef1672e7a0013c4adb1df8141/build_tarballs.jl#L33">davidanthoff/ReadStatBuilder</a> - windows check</p></li><li><p><a href="https://github.com/JuliaDiffEq/SundialsBuilder/blob/6a155530557ac2c49277d33baf02f30921739348/build_tarballs.jl#L125-L131">JuliaDiffEq/SundialsBuilder</a> - 32-bit check</p></li></ul><p>It is also possible to run quite different scripts for each target by running different build scripts for different sets of targets. Here is an example where windows builds are separated from other targets:</p><ul><li><p><a href="https://github.com/Keno/ZlibBuilder/blob/master/build_tarballs.jl">Keno/ZlibBuilder</a></p></li></ul><h2><a class="nav-anchor" id="Autoconfigure-builds-1" href="#Autoconfigure-builds-1">Autoconfigure builds</a></h2><p>Autoconfigure builds are generally quite straightforward. Here is a typical approach:</p><pre><code class="language-sh">./configure --prefix=$prefix --host=${target}
make -j${nproc}
make install</code></pre><p>Here are examples of autoconfigure build scripts:</p><ul><li><p><a href="https://github.com/staticfloat/OggBuilder/blob/master/build_tarballs.jl">staticfloat/OggBuilder</a></p></li><li><p><a href="https://github.com/staticfloat/NettleBuilder/blob/master/build_tarballs.jl">staticfloat/NettleBuilder</a></p></li></ul><h2><a class="nav-anchor" id="CMake-builds-1" href="#CMake-builds-1">CMake builds</a></h2><p>For CMake, the wizard will suggest a template for running CMake. Typically, this will look like:</p><pre><code class="language-sh">make -DCMAKE_INSTALL_PREFIX=$prefix -DCMAKE_TOOLCHAIN_FILE=/opt/$target/$target.toolchain</code></pre><p>The toolchain file sets up several CMake environment variables for better cross-platform support: </p><pre><code class="language-sh"># Toolchain file for x86_64-linux-gnu
set(CMAKE_SYSTEM_NAME Linux)

set(CMAKE_SYSROOT /opt/x86_64-linux-gnu/x86_64-linux-gnu/sys-root/)
set(CMAKE_INSTALL_PREFIX /)

set(CMAKE_C_COMPILER /opt/x86_64-linux-gnu/bin/x86_64-linux-gnu-gcc)
set(CMAKE_CXX_COMPILER /opt/x86_64-linux-gnu/bin/x86_64-linux-gnu-g++)

set(CMAKE_FIND_ROOT_PATH_MODE_PROGRAM NEVER)
set(CMAKE_FIND_ROOT_PATH_MODE_LIBRARY ONLY)
set(CMAKE_FIND_ROOT_PATH_MODE_INCLUDE ONLY)
set(CMAKE_FIND_ROOT_PATH_MODE_PACKAGE ONLY)</code></pre><p>Examples of builds that include CMake parts include:</p><ul><li><p><a href="https://github.com/staticfloat/IpoptBuilder/blob/master/build_tarballs.jl">staticfloat/IpoptBuilder</a></p></li><li><p><a href="https://github.com/davidanthoff/SnappyBuilder/blob/master/build_tarballs.jl">davidanthoff/SnappyBuilder</a></p></li><li><p><a href="https://github.com/JuliaDiffEq/SundialsBuilder/blob/master/build_tarballs.jl">JuliaDiffEq/SundialsBuilder</a></p><ul><li><p>Needs <code>-DSUNDIALS_INDEX_TYPE=int32_t</code> on 32-bit targets (Sundials-specific way to specify integer size)</p></li><li><p>Needs to copy *.dll files from <code>destdir/lib</code> to <code>destdir/bin</code> for windows; this also removes symlinks by using <code>cp -L</code></p></li><li><p>Needs <code>-DCMAKE_FIND_ROOT_PATH=&quot;$WORKSPACE/destdir&quot;</code>, so CMake&#39;s <code>find_library</code> can find libraries from KLU</p></li></ul></li></ul><h2><a class="nav-anchor" id="Builds-with-binary-dependencies-1" href="#Builds-with-binary-dependencies-1">Builds with binary dependencies</a></h2><p>A build script can depend on binaries generated by another Builder repository. A builder specifies <code>dependencies</code> like:</p><pre><code class="language-julia">dependencies = [
    # We need libogg to build FLAC
    &quot;https://github.com/staticfloat/OggBuilder/releases/download/v1.3.3-0/build.jl&quot;
]</code></pre><p>Each of the <code>dependencies</code> points to a <code>build.jl</code> file, usually provided with a release of another Builder repository.</p><p>In the wizard, this can be specified with the prompt: <em>Do you require any (binary) dependencies?  [y/N]</em>.</p><p>Examples of builders that depend on other binaries include:</p><ul><li><p><a href="https://github.com/staticfloat/FLACBuilder/blob/master/build_tarballs.jl">staticfloat/FLACBuilder</a> depends on <a href="https://github.com/staticfloat/OggBuilder/blob/master/build_tarballs.jl">staticfloat/OggBuilder</a> (<a href="https://github.com/staticfloat/OggBuilder/releases/download/v1.3.3-0/build.jl">build.jl</a>).</p></li></ul><h2><a class="nav-anchor" id="Editing-files-in-the-wizard-1" href="#Editing-files-in-the-wizard-1">Editing files in the wizard</a></h2><p>In the wizard, the <code>vi</code> editor is available for editing files. But, it doesn&#39;t leave any record in the build script. One generally needs to provide patch files or sue something like <code>sed</code>. Here is an approach using <code>diff</code> and <code>patch</code>:</p><pre><code class="language-sh">cp file.ext file.ext.orig
vi file.ext     # make the changes
diff -u file.ext.orig file.ext
# Create a patch based on the results copy-pasted from the output of `diff`
cat &gt; file.patch &lt;&lt;&#39;END&#39;
--- file.ext.orig 2017-12-14 19:28:48.816021000 -0500
+++ file.ext2017-12-14 19:29:03.912021000 -0500
@@ -1,4 +1,5 @@
 -https://computation.llnl.gov/projects/sundials/download/sundials-3.0.0.tar.gz
 +https://computation.llnl.gov/projects/sundials/download/sundials-3.1.0.tar.gz
  
  http://faculty.cse.tamu.edu/davis/SuiteSparse/SuiteSparse-5.0.0.tar.gz
 
END
# Apply the patch
patch -l file.ext.orig file.patch -o file.ext</code></pre><p>There are plans to handle file changes in the wizard automatically <a href="https://github.com/JuliaPackaging/BinaryBuilder.jl/issues/125">(#25)</a>.</p><h2><a class="nav-anchor" id="Other-examples-1" href="#Other-examples-1">Other examples</a></h2><p>Examples of other interesting builders include:</p><ul><li><p><a href="https://github.com/Keno/LinuxBuilder/blob/master/build_tarballs.jl">Keno/LinuxBuilder</a> – Why not build Linux?</p></li></ul><footer><hr/><a class="previous" href="index.html"><span class="direction">Previous</span><span class="title">Home</span></a><a class="next" href="FAQ.html"><span class="direction">Next</span><span class="title">FAQ</span></a></footer></article></body></html>
