<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Tricksy Gotchas · BinaryBuilder.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">BinaryBuilder.jl</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../building/">Building Packages</a></li><li><a class="tocitem" href="../build_tips/">Build Tips</a></li><li><a class="tocitem" href="../jll/">JLL packages</a></li><li><a class="tocitem" href="../FAQ/">FAQ</a></li><li><a class="tocitem" href="../troubleshooting/">Build Troubleshooting</a></li><li><span class="tocitem">Internals</span><ul><li><a class="tocitem" href="../rootfs/">RootFS</a></li><li><a class="tocitem" href="../environment_variables/">Environment Variables</a></li><li class="is-active"><a class="tocitem" href>Tricksy Gotchas</a></li><li><a class="tocitem" href="../reference/">Reference</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Internals</a></li><li class="is-active"><a href>Tricksy Gotchas</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Tricksy Gotchas</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaPackaging/BinaryBuilder.jl/blob/master/docs/src/tricksy_gotchas.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Tricksy-Gotchas"><a class="docs-heading-anchor" href="#Tricksy-Gotchas">Tricksy Gotchas</a><a id="Tricksy-Gotchas-1"></a><a class="docs-heading-anchor-permalink" href="#Tricksy-Gotchas" title="Permalink"></a></h1><p>There are a plethora of gotchas when it comes to binary compilation and distribution that must be appropriately addressed, or the binaries will only work on certain machines and not others.  Here is an incomplete list of things that <code>BinaryBuilder.jl</code> takes care of for you:</p><ul><li>Uniform compiler interface</li></ul><p>No need to worry about invoking compilers through weird names; just run <code>gcc</code> within the proper environment and you&#39;ll get the appropriate cross-compiler.  Triplet-prefixed names (such as <code>x86_64-linux-gnu-gcc</code>) are, of course, also available, and the same version of <code>gcc</code>, <code>g++</code> and <code>gfortran</code> is used across all platforms.</p><ul><li><code>glibc</code> versioning</li></ul><p>On Linux platforms that use <code>glibc</code> as the C runtime library (at the time of writing, this is the great majority of most desktop and server distros), it is necessary to compile code against a version of <code>glibc</code> that is <em>older</em> than any glibc version it will be run on.  E.g. if your code is compiled against <code>glibc v2.5</code>, it will run on <code>glibc v2.6</code>, but it will not run on <code>glibc v2.4</code>.  Therefore, to maximize compatibility, all code should be compiled against as old a version of <code>glibc</code> as possible.</p><ul><li><code>gfortran</code> versioning</li></ul><p>When compiling FORTRAN code, the <code>gfortran</code> compiler has broken ABI compatibility in the 6.X -&gt; 7.X transition, and the 7.X -&gt; 8.X transition.  This means that code built with <code>gfortran</code> 6.X cannot be linked against code built with <code>gfortran</code> 7.X.  We therefore compile all <code>gfortran</code> code against multiple different <code>gfortran</code> versions, then at runtime decide which to download based upon the currently running process&#39; existing linkage.</p><ul><li><code>cxx11</code> string ABI</li></ul><p>When switching from the <code>cxx03</code> standard to <code>cxx11</code> in GCC 5, the internal layout of <code>std::string</code> objects changed.  This causes incompatibility between C++ code passing strings back and forth across the public interface if they are not built with the same C++ string ABI.  We therefore detect when <code>std::string</code> objects are being passed around, and warn that you need to build two different versions, one with <code>cxx03</code>-style strings (doable by setting <code>-D_GLIBCXX_USE_CXX11_ABI=0</code> for newer GCC versions) and one with <code>cxx11</code>-style strings.</p><ul><li>Library Dependencies</li></ul><p>A large source of problems in binary distribution is improper library linkage.  When building a binary object that depends upon another binary object, some operating systems (such as macOS) bake the absolute path to the dependee library into the dependent, whereas others rely on the library being present within a default search path.  <code>BinaryBuilder.jl</code> takes care of this by automatically discovering these errors and fixing them by using the <code>RPATH</code>/<code>RUNPATH</code> semantics of whichever platform it is targeting.  Note that this is technically a build system error, and although we will fix it automatically, it will raise a nice yellow warning during build prefix audit time.</p><ul><li>Embedded absolute paths</li></ul><p>Similar to library dependencies, plain files (and even symlinks) can have the absolute location of files embedded within them.  <code>BinaryBuilder.jl</code> will automatically transform symlinks to files within the build prefix to be the equivalent relative path, and will alert you if any files within the prefix contain absolute paths to the build prefix within them.  While the latter cannot be automatically fixed, it may help in tracking down problems with the software later on.</p><ul><li>Instruction Set Differences</li></ul><p>When compiling for architectures that have evolved over time (such as <code>x86_64</code>), it is important to target the correct instruction set, otherwise a binary may contain instructions that will run on the computer it was compiled on, but will fail rather ungracefully when run on a machine that does not have as new a processor.  <code>BinaryBuilder.jl</code> will automatically disassemble every built binary object and inspect the instructions used, warning the user if a binary is found that does not conform to the agreed-upon minimum instruction set architecture.  It will also notice if the binary contains a <code>cpuid</code> instruction, which is a good sign that the binary is aware of this issue and will internally switch itself to use only available instructions.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../environment_variables/">« Environment Variables</a><a class="docs-footer-nextpage" href="../reference/">Reference »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Tuesday 27 April 2021 02:01">Tuesday 27 April 2021</span>. Using Julia version 1.6.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
